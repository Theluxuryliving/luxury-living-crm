<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CRM - Lead Status Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/pouchdb@7.3.1/dist/pouchdb.min.js"></script>
<button onclick="exportToSheets()">Export</button>
<button onclick="importFromSheets()">Import</button>

<script src="sheets.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .stage-card { border: 1px solid #ccc; border-radius: 8px; padding: 10px; margin: 10px 0; background: #f9f9f9; }
    .btn { padding: 8px 12px; font-weight: bold; background: #eee; display: inline-block; cursor: pointer; margin: 10px 5px; }
  </style>
</head>
<body>

<!-- CRM Navigation Bar -->
<div style="background:#f0f0f0; padding:10px; margin-bottom:20px; border-bottom:1px solid #ccc;">
  <strong>CRM Navigation:</strong>
  <a href="leads.html" style="margin:0 10px;">Leads</a>
  <a href="deals.html" style="margin:0 10px;">Deals & Payments</a>
  <a href="projects_inventory.html" style="margin:0 10px;">Projects & Inventory</a>
  <a href="sales_flow.html" style="margin:0 10px;">Sales Flow</a>
  <a href="lead_status.html" style="margin:0 10px;">Lead Status</a>
  <a href="dashboard.html" style="margin:0 10px;">Dashboard</a>
  <a href="#" onclick="exportToSheets()">Export</a>
  <a href="#" onclick="importFromSheets()">Import</a>
</div>

<h1>Lead Status Tracker</h1>

<div id="statusContainer"></div>

<script>
  const dbLeads = new PouchDB('crm_leads');

  async function loadLeadStatus() {
    const result = await dbLeads.allDocs({ include_docs: true });
    const leads = result.rows.map(r => r.doc);
    const statuses = ["new", "contacted", "interested", "matured", "closed", "lost"];

    const grouped = {};
    statuses.forEach(status => grouped[status] = []);
    leads.forEach(lead => {
      if (grouped[lead.status]) grouped[lead.status].push(lead);
    });

    const container = document.getElementById('statusContainer');
    container.innerHTML = statuses.map(status => `
      <div class="stage-card">
        <h3>${status.toUpperCase()} (${grouped[status].length})</h3>
        ${grouped[status].map(l => `<div><strong>${l.name}</strong> - ${l.contact_number}</div>`).join('') || '<i>No leads</i>'}
      </div>
    `).join('');
  }

  loadLeadStatus();
</script>

</body>
</html>
